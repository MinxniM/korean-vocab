<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Random Korean Visual Vocab</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      text-align: center;
      padding: 40px;
      background: #f7f7f7;
    }
    .card {
      background: white;
      max-width: 420px;
      margin: auto;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    img {
      max-width: 100%;
      border-radius: 12px;
      margin: 16px 0;
    }
    .word {
      font-size: 36px;
      font-weight: bold;
    }
    .meaning {
      font-size: 20px;
      color: #444;
      margin-top: 8px;
    }
    button {
      font-size: 18px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background: #2563eb;
      color: white;
      margin-top: 16px;
    }
    .small {
      font-size: 12px;
      color: #888;
      margin-top: 12px;
    }
  </style>
</head>
<body>

  <h1>üá∞üá∑ Random Korean Visual Vocab</h1>

  <div class="card">
    <div class="word" id="word">‚Äî</div>
    <div class="meaning" id="meaning">‚Äî</div>
    <img id="image" src="" alt="" />
    <button onclick="randomWord()">üé≤ Random</button>
    <div class="small" id="source">Source: KrDict</div>
  </div>

<script>
/* ==============================
   CONFIG ‚Äî B·∫†N PH·∫¢I ƒêI·ªÄN KEY
================================ */

// KrDict API (B·∫ÆT BU·ªòC)
const KRDICT_API_KEY = "E66AAE96C6A9703D0D39EF8FAF1A0F3E";

// Ch·ªçn 1 trong 2: Pexels ho·∫∑c Unsplash
const PEXELS_API_KEY = "4q0EefZngW4teQbOwW5KC6wfSpz0CNOeKMSt8EhDAp2FXwbHcJYlJ3NR";
// const UNSPLASH_ACCESS_KEY = "YOUR_UNSPLASH_ACCESS_KEY";

/* ==============================
   KRDICT RANDOM
================================ */

async function randomWord() {
  try {
    setLoading();

    // Random page (KrDict c√≥ r·∫•t nhi·ªÅu trang)
    const randomPage = Math.floor(Math.random() * 500) + 1;

    const url = `https://krdict.korean.go.kr/api/search` +
      `?key=${KRDICT_API_KEY}` +
      `&q=*` +
      `&part=word` +
      `&translated=y` +
      `&trans_lang=vi` +
      `&num=20` +
      `&start=${randomPage}` +
      `&sort=dict`;

    const res = await fetch(url);
    const text = await res.text();

    const parser = new DOMParser();
    const xml = parser.parseFromString(text, "text/xml");

    const items = Array.from(xml.querySelectorAll("item"));
    if (items.length === 0) {
      throw new Error("No words from KrDict");
    }

    const item = items[Math.floor(Math.random() * items.length)];

    const ko = item.querySelector("word")?.textContent || "‚Äî";
    const vi = item.querySelector("trans_word")?.textContent || "‚Äî";

    document.getElementById("word").textContent = ko;
    document.getElementById("meaning").textContent = vi;

    // L·∫•y ·∫£nh minh h·ªça
    const imgUrl = await getImage(vi || ko);
    document.getElementById("image").src = imgUrl || "";

  } catch (err) {
    console.error(err);
    document.getElementById("word").textContent = "L·ªói üò¢";
    document.getElementById("meaning").textContent = "Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu";
    document.getElementById("image").src = "";
  }
}

function setLoading() {
  document.getElementById("word").textContent = "Loading...";
  document.getElementById("meaning").textContent = "";
  document.getElementById("image").src = "";
}

/* ==============================
   IMAGE API ‚Äî PEXELS
================================ */

async function getImage(keyword) {
  if (!keyword) return "";

  // ---- PEXELS ----
  const res = await fetch(
    `https://api.pexels.com/v1/search?query=${encodeURIComponent(keyword)}&per_page=1`,
    {
      headers: {
        Authorization: PEXELS_API_KEY
      }
    }
  );

  const data = await res.json();
  return data.photos?.[0]?.src?.medium || "";
}

/* ==============================
   AUTO LOAD
================================ */
randomWord();
</script>

</body>
</html>
